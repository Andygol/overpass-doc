Модель даних OpenStreetMap
==========================

Для того, щоб зрозуміти як працює Overpass API
потрібно в першу чергу розглянути модель даних OpenStreetMap.

У цьому розділі ми розглянемо основні структури даних OpenStreetMap.
OpenStreetMap насамперед містить три типи даних:

* Геометрія, а точніше координати та посилання на координати, описує положення об'єктів на земній поверхні.
* Короткі фрагменти тексту надають кожному об'єкту семантичного значення.
* Метадані допомагають зіставити джерела з даними.

Усі критерії вибору мови запитів стосуються властивостей цих структур даних.

Крім того, дані можуть представлятись кількома форматами даних.
Більш докладно про це йдеться в розділі [Формати даних](../targets/formats.md).

Обробка різних типів геометрії, так щоб в результаті отримати геометричні форми з якими можна працювати, заслуговує власного посібника.
Такий посібник ви знайдете в розділі [Геометрія](../full_data/osm_types.md).

<a name="tags"/>
## Теґи

Семантика даних OpenStreetMap описується за допомогою коротких текстових фрагментів, які називаються  _теґами_.
_Теґи_ складаються з пари _ключ_ та _значення_.
Кожен об'єкт може мати для кожного _ключа_ не більше одного _значення_.
Крім обмеження довжини у 255 символів для кожного ключа та значення, інші обмеження не застосовуються.

Модель даних не виділяє жодного конкретного тегу чи ключа.
Теги можна вибирати спонтанно та наскільки це зручно;
ця правило, швидше за все, посприяло успіху OpenStreetMap.

В ключах практично виключно переважають літери латинської абетки в нижньому регістрі та іноді спеціальні символи `:` і `\_`.
Теґи поділяють на дві неформальні групи:

Теґи, що використовуються для _класифікації_ об'єктів мають один з визначених ключів,
кожен з яких має наперед визначені переліки значень.
Відхилення від них вважатиметься помилкою.
Наприклад, для позначення доріг, які використовуються для руху траспортних засобів, застосовується ключ [highway](https://taginfo.openstreetmap.org/keys/highway) разом з одним із визначеним мапером значенням.

У таких теґах значення іноді може містити кілька значень, об'єднаних крапкою з комою.
Це, як правило, є допустимою практикою встановлення кількох значень для одного ключа на одному об'єкті.

Теґи, що використовуються для _опису_ мають лише фіксовані ключі, в той час, як в його значенні може бути будь-яка довільна інформація, що містить літери верхнього та нижнього регістрів, числа, спеціальні символи, розділові знаки.
Назви - найпомітніший випадок.
Але описи, ідентифікатори або навіть розміри також є звичайною справою.

Найпопулярніші джерела семантики ключів та значень:

* [Вікі OSM](https://wiki.openstreetmap.org/wiki/Uk:Map_Features).
  Містить докладні описи теґів та правила їх застосування.
  Але іноді трапляється так, що опис віддзеркалює бачення автора тексту ніж справжню практику застосування теґу.
* [Taginfo](https://taginfo.openstreetmap.org/).
  Рахує кількість теґів в даних.
  Містить посилання на інші ресурси з інформацією щодо зазначених теґів.

Розділ [Пошук об'єктів](../criteria/index.md) присвячено саме пошуку об'єктів за їх теґами.

<a name="nwr"/>
## Точки, Лінії, Зв'язки

OpenStreetMap має три типи об'єктів.
Кожен з них може мати довільну кількість теґів.
Крім цього, кожен з об'єктів має ідентифікатор.
Поєднання типу об'єкту та його ідентифікатора є унікальним, сам по собі ідентифікатор не унікальний.

_Точки_ крім ідентифікатора та теґів визначаються координатами.
Точка може представляти об'єкт інтересу чи об'єкт невеликого розміру.
Через те, що тільки точки мають координати, більшість з них відіграють роль проміжних точок в лініях і не мають власних теґів.

_Лінії_ складаються з послідовності точок на додачу до ідентифікатора та теґів, що позначають чим є лінія.
Лінії отримують власну геометрію використовуючи координати точок, з яких вони складаються.
Крім цього лінія має власну топологію:
дві лінії вважаються з'єднаними, якщо до їх складу входить одна й та ж точка.

Лінії можуть посилатись на одну точку кілька разів.
Наприклад, замкненна лінія, коли кінець та початок лінії збігаються в одній тій самій точці.
Усі інші випадки є синтаксично правильними, але семантично застарілими.

_Зв'язки_ складаються з послідовності членів на додачу до ідентифікатора та теґів.
Членами зв'язку можуть бути точки, лінії та інші зв'язки, які можуть мати роль (ролі описують властивості членів в межах зв'язку).
Роль - текстовий рядок.
Зв'язки було запроваджено для мапінгу обмежень маневрів, що складаються із кількох членів.
Зараз, зв'язки використовуються для мапігу кордонів країн, штатів, мультиполігонів та зазначення маршрутів.
Отже, їх структура досить різноманітна, а кордони та маршрути можуть простягатись на тисячі кілометрів.

Геометрія зв'язків проявляється лише під час їх інтерпретації користувачами даних.
Інтерпретація мультиполігонів отримала таке загальне визнання:
так само як і лінії, зв'язки вважаться полігонами, коли їх члени утворюють замкнені контур(и).
Інтерпретації починаються з питання, чи потрібна для цього наявність тегу _area_=_yes_.
Інші зв'язки, такі як обмеження маневрів чи маршрути, отримують свою геометрію як суму геометрій їхніх членів, точок та ліній.

Зв'язки, які складаються зі зв'язків технічно можливі, але не завжди мають практичне значення.
В такому випадку, коли ви отримуєте лише одного члена зв'язку, значно зростає ймовірність отримати всі його батьківські зв'язки, що не завжди потрібно.
Тому існує багато різних способів, в залежності від того що ви намагаєтесь отримати, щоб не витягувати [весь зв'язок](../full_data/osm_types.md#rels_on_rels).

<a name="areas"/>
## Полігони

Полігони не мають власного типу даних в OpenStreetMap.
Вони утворюються за допомогою замкнених _ліній_ чи _зв'язків_.
Теґи мають значення для визначення того чи об'єкт є полігоном чи замкненою лінією,
найпростіший спосіб - додати теґ _area_=_yes_.

Замкнені лінії використовуються у випадках коли ділянка не містить отворів.
Лінія вважається замкненою, якщо перша та остання точки збігаються.

Зв'язки використовуються коли використання замкненої лінії не підходить.
Крім позначення отворів та розділених на окремі частини територій, зв'язки використовуються для позначення меж територій, які складаються з кількох з'єднаних один з одним відрізків.
Зазвичай це більше стосуються меж великих територій (міст, областей, країн).

Так само як і у випадку з лініями, території визначаються їх межами.
Таким чином, у згаданих зв'язках лінії повинні утворювати замкнені кільця.
Більше відомостей про [конвенції](https://github.com/osmlab/fixing-polygons-in-osm/blob/master/doc/background.md).

<a name="metas"/>
## Метадані

В OpenStreetMap є повноцінна система контролю версій.
Старі версії зберігаються так само як і те ким були зроблені зміни.

Для кожного об'єкта зберігається _номер версії_ та _відбиток часу_.
Залишаються попередні версії та стан об'єктів залишаються в базі.
Overpass API здатен з допомогою [спеціальних методів](../analysis/index.md) отримувати доступ до попередніх станів.
Але без використання спеціальних запитів Overpass API завжди працює з поточними даними.

На додачу, зміни групуються за _наборами змін_.
Вони асоціюються з мапером, який їх завантажив до бази даних.
Таке групування відбувається автоматично програмою редактором
і зазвичай один набір змін містить - одне завантаження даних на сервер.

_Набори змін_ також мають власні теґи. Набори змін можна обговорювати з іншими маперами.
Ці обговорення не обробляються Overpass API.

Таким чином кожен об'єкт асоціюється з певним мапером.
Це мапер який завантажив останню версію змін.

Тому об'єкти з номером версії вище ніж 1, зазвичай зберігають властивості попередніх версій, хоча ці властивості не можна віднести до поточного мапера.

<a name="declined"/>
## Шари, категорії, ідентичність

На відміну від інших систем OpenStreetMap не містить тематичних шарів. Це зроблено навмисно.

Для когось супермаркети разом з поштовими відділеннями, банками та банкоматами - це місця, де можна отримати готівку.
Для інших супермаркети - це група місць, скоріше спільна з пекарнями та м'ясними лавками, оскільки там можна купити їжу.

Тому класифікація відіграє лише незначну роль в OpenStreetMap.
Доцільніше реєструвати об’єктивні властивості.
Загалом суперечкам вдалося запобігти, і більшість маперів можуть зазначити свою точку зору без істотних спотворень.

Іншими часто очікуваними структурами є категорії, незалежно від того, чи є вони загальними, як усі відділення мережі швидкого харчування або всі поштові скриньки в Шотландії.
OpenStreetMap - геопросторова база даних.
Перелік всіх об'єктів з певними властивостями на обмеженій території може бути обчислений.
До того ж Overpass API є одним з інструментів призначеним для цього, в розділі [Пошук об'єктів](../criteria/index.md) пояснюється як це зробити.

Переліки об'єктів у всьому світі, що мають певні властивості, у кращому випадку, мають слабку геопросторову релевантність.
Хоча кожна філія має місце розташування, мережа швидкого харчування в цілому отримує свою просторову інформацію виключно через свої відділення.

Нарешті, концепція ідентичності залишає пріоритет її просторовому прояву.
Подібно до проблеми зі шарами, різні мапери мають різні уявлення про те, що належить до такої складної речі, як велика залізнична станція.
Тільки рейки та платформи?
Чи також будівля станції, чи тільки якщо вона обслуговує пасажирів, або якщо тільки вона належить залізничній компанії?
Площа перед вокзалом, автобусні зупинки, що мають назву подібну до назви станції?
Точки, які за правилами експлуатації залізниці пов'язані зі станцією, навіть якщо вони знаходяться далеко?

Якщо є потреба прив'язати точку певного об'єкта до землі - краще для цього скористатись координатами.

Стаціонарні об’єкти не рухаються за своїм визначенням
і позиційна точність в OpenStreetMap досить хороша
таким чином, що координати є найкращим якорем для цього.
